<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-signin-client_id" content="228234052599-8fir3jm9d4340127pim59925m2k1bm4a.apps.googleusercontent.com">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

     <!--Fontawesome CDN-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    
    <!--Custom styles-->
	  <link rel="stylesheet" type="text/css" href="style.css">

    
    <title>Fancy Todos</title>
  </head>
  <!-- body -->
  <!-- navbar -->
  <body>
    <nav class="navbar navbar-expand-lg navbar navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Fancy Todo</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li id="get-all-todos" class="nav-item">
              <a class="nav-link active" aria-current="page" href="#" onclick="getAllTodos()">All Todo</a>
            </li>
            <li id="add-todo" class="nav-item">
              <a class="nav-link active" aria-current="page" href="#" onclick="">Add Todo</a>
            </li>
          </ul>
          <form class="d-flex">
            <input id="search-box" class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
            <button id="search-btn" class="btn btn-outline-success" type="submit">Search</button>
          </form>
        </div>
      </div>
    </nav>

        <!-- Button trigger modal
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
        Launch demo modal
      </button> -->

      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              ...
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>


      <!-- login -->
      <div id="login-page" class="container-login">
        <div class="d-flex justify-content-center h-100">
          <div class="card">
            <div class="card-header">
              <h3>Sign In</h3>
            </div>
            <div class="card-body">
              <form id="login-form">
                <div class="input-group form-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                  </div>
                  <input id="email-login" type="email" class="form-control" placeholder="email">
                </div>
                <div class="input-group form-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fas fa-key"></i></span>
                  </div>
                  <input id="password-login" type="password" class="form-control" placeholder="password">
                </div>
                <div class="form-group">
                  <input type="submit" value="Login" class="btn float-right login_btn">
                  <!-- Google Login -->
                </div>
                <div class="google">
                  <div class="g-signin2" data-onsuccess="onSignIn"></div>
                </div>
              </form>
            </div>
            <div class="card-footer">
              <div class="d-flex justify-content-center links">
                Don't have an account?<a href="#" onclick="registerLink()">Sign Up</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- login -->

      <!-- register -->
      <div id="register-page" class="container-register">
        <div class="d-flex justify-content-center h-100">
          <div class="card">
            <div class="card-header">
              <h3>Register</h3>
            </div>
            <div class="card-body">
              <form id="register-form">
                <div class="input-group form-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                  </div>
                  <input id="email-register" type="text" class="form-control" placeholder="email">
                </div>
                <div class="input-group form-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text"><i class="fas fa-key"></i></span>
                  </div>
                  <input id="password-register" type="password" class="form-control" placeholder="password">
                </div>
                <div class="form-group">
                  <input type="submit" value="Register" class="btn float-right register_btn">
                </div>
              </form>
            </div>
            <div class="card-footer">
              <div class="d-flex justify-content-center links">
                Have an account?<a href="#" onclick="checkAccessToken()">Sign In</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Register -->

    <!-- list Todos -->
    <div class="container-todos">
      <div style="display: flex; flex-direction: row;">
        <div id="pending-todos">
          <h1>Pending</h1>
          <div id="list-todos-pending"></div>
        </div>
        <div id="done-todos">
          <h1>Done</h1>
          <div id="list-todos-done"></div>
        </div>
      </div>
    </div>
    <!-- list Todos -->

    <!-- Add Todo -->
    <div id="add-todo-page" class="container-add-todo">
      <div class="d-flex justify-content-center h-100">
        <div class="card">
          <div class="card-header">
            <h3>Add Todo</h3>
          </div>
          <div class="card-body">
            <form id="Add-todo-form">
              <div class="input-group form-group">
                <input id="title-register" type="text" class="form-control" placeholder="Title">
              </div>
              <div class="input-group form-group">
                <input id="password-register" type="password" class="form-control" placeholder="Description">
              </div>
              <div class="container">
                <div class="row">
                    <div id="date-input" class="col-sm-6">
                        <div class="form-group">
                            <div class="input-group date" id="datetimepicker4" data-target-input="nearest">
                                <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker4"/>
                                <div class="input-group-append" data-target="#datetimepicker4" data-toggle="datetimepicker">
                                    <div id="logo-date-input" class="input-group-text"><i class="fa fa-calendar"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <script type="text/javascript">
                        $(function () {
                            $('#datetimepicker4').datetimepicker({
                                format: 'L'
                            });
                        });
                    </script>
                </div>
            </div>
              <div class="form-group">
                <input type="submit" value="Add Todo" class="btn float-right register_btn">
              </div>
            </form>
          </div>
          <div class="card-footer">
            <div class="d-flex justify-content-center links">
              Have an account?<a href="#" onclick="checkAccessToken()">Sign In</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    <!-- Add Todo -->

    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.39.0/js/tempusdominus-bootstrap-4.min.js" integrity="sha512-k6/Bkb8Fxf/c1Tkyl39yJwcOZ1P4cRrJu77p83zJjN2Z55prbFHxPs9vN7q3l3+tSMGPDdoH51AEU8Vgo1cgAA==" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.39.0/css/tempusdominus-bootstrap-4.min.css" integrity="sha512-3JRrEUwaCkFUBLK1N8HehwQgu8e23jTH4np5NHOmQOobuC4ROQxFwFgBLTnhcnQRMs84muMh0PnnwXlPq5MGjg==" crossorigin="anonymous" />
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script>
      const baseUrl = "http://localhost:3500/"
      
      function checkAccessToken() {
        if (!localStorage.getItem("access_token")) {
          $("#login-page").show()
          $("#register-page").hide()
          $("#search-box").hide()
          $("#search-btn").hide()
        } else {
          $("#login-page").hide()
          $("#register-page").hide()
          $("#search-box").show()
          $("#search-btn").show()
          getAllTodos()
        }
      }

      function registerLink() {
          $("#login-page").hide()
          $("#register-page").show()
          $("#search-box").hide()
          $("#search-btn").hide()
      }

      function loginLink() {

      }

      function login() {
        const email = $("#email-login").val()
        const password = $("#password-login").val()
        const test = localStorage.getItem("access_token")
        console.log(test, 'akses');
        $.ajax({
          url: baseUrl + "users/login",
          method: "POST",
          data: {
            email,
            password
          }
        }).done(response => {
          const token = response
          localStorage.setItem("access_token", token)
          checkAccessToken()
        }).fail((xhr, text) => {
          console.log(xhr, text);
        }).always((_) => {
          console.log('always');
          $("#login-form").trigger("reset")
        })
      }

      function register() {
        const email = $("#email-register").val();
        const password = $("#password-register").val();

        $.ajax({
          url: baseUrl + "users/register",
          method: "POST",
          data: {
            email,
            password
          }
        }).done(response => {
          checkAccessToken()
          $("#register-form").trigger("reset")
        }).fail((xhr, text) => {
          console.log(xhr, text);
        }).always((_) => {
          console.log('always');
        })
      }

      function getAllTodos() {
        const access_token = localStorage.getItem("access_token");
        
        $.ajax({
          url: baseUrl + "todos/",
          method: "GET",
          headers: {
            access_token,
          },
        }).then(response => {
          const getDone = response.filter(element => element.status)
          const getProgress = response.filter(element => !element.status)
          const todosDone = getDone.map((element) => `
            <div class="card">
              <div class="card-body-doneTodos">
                <h5 class="card-title">Title<br><ul> ${element.title}</h5>
                <p class="card-description">Description<br><ul> ${element.description}</p>
                <a href="#" class="btn btn-primary edit-todo" name="${element.id}">Edit</a>
                <a href="#" class="btn btn-primary delete-todo" name="${element.id}">Delete</a>
                </div>
            </div>
          `)
          const todosPending = getProgress.map((element) => `
            <div class="card">
              <div class="card-body-pendingTodos">
                <h5 class="card-title">Title<br><ul> ${element.title}</h5>
                <p class="card-description">Description<br><ul> ${element.description}</p>
                <a href="#" class="btn btn-primary edit-todo" name="${element.id}">Edit</a>
                <a href="#" class="btn btn-primary mark-done-todo" name="${element.id}">Mark as Done</a>
                <a href="#" class="btn btn-primary delete-todo" name="${element.id}">Delete</a>
              </div>
            </div>
          `)  
          const wrapDone = `<div> ${todosDone.join('\n')} </div>` 
          const wrapPending = `<div> ${todosPending.join('\n')} </div>`

          $("#list-todos-done").empty()
          $("#list-todos-done").append(wrapDone)
          $("#list-todos-pending").empty()
          $("#list-todos-pending").append(wrapPending)
        }).fail((xhr, text) => {
          console.log(xhr, text);
        }).always((_) => {
          console.log('always');
        })
      }

      function addTodo(){

      }
      




      $(document).ready(() => {
        checkAccessToken()
        $("#login-form").on("submit", (e) => {
          e.preventDefault()
          login()
        })
        $("#register-form").on("submit", (e) => {
          e.preventDefault()
          register()
        })
      })


      // google signin//

      function onSignIn(googleUser) {
        // var profile = googleUser.getBasicProfile();
        // console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
        // console.log('Name: ' + profile.getName());
        // console.log('Image URL: ' + profile.getImageUrl());
        // console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
        var id_token = googleUser.getAuthResponse().id_token;

        $.ajax({
          url: baseUrl + "users/googleLogin",
          method: "POST",
          data: {
            idToken: id_token
          }
        }).done(({access_token}) => {
          console.log(access_token);
          localStorage.setItem("access_token", access_token)
          checkAccessToken()
        }).fail((xhr, text) => {
          console.log(xhr, text, 'errhtml');
        }).always((_) => {
          console.log('always');
        })

      }
      //===========//
      // $.get('http://localhost:3500/todos/', (data, textStatus, jqXHR) => {  
      //   $(document).ready(() => {
      //     const getDone = data.filter(element => element.status)
      //     const getProgress = data.filter(element => !element.status)
      //     const todosDone = getDone.map((element) => `
      //       <div class="card" style="width: 20rem;">
      //         <div class="card-body">
      //           <h5 class="card-title">${element.title}</h5>
      //           <p class="card-description">${element.description}</p>
      //           <a href="#" class="btn btn-primary edit-todo" name="${element.id}">Edit</a>
      //           <a href="#" class="btn btn-primary delete-todo" name="${element.id}">Delete</a>
      //           </div>
      //       </div>
      //     `)
      //     const todosPending = getProgress.map((element) => `
      //       <div class="card scale-up-center" style="width: 20rem;">
      //         <div class="card-body">
      //           <h5 class="card-title">${element.title}</h5>
      //           <p class="card-description">${element.description}</p>
      //           <a href="#" class="btn btn-primary edit-todo" name="${element.id}">Edit</a>
      //           <a href="#" class="btn btn-primary mark-done-todo" name="${element.id}">Mark as Done</a>
      //           <a href="#" class="btn btn-primary delete-todo" name="${element.id}">Delete</a>
      //         </div>
      //       </div>
      //     `)  
      //     const wrapDone = `<div> ${todosDone.join('\n')} </div>` 
      //     const wrapPending = `<div> ${todosPending.join('\n')} </div>`

      //     $("#list-todos-done").append(wrapDone)
      //     $("#list-todos-pending").append(wrapPending)
      //     $(".delete-todo").click((e) => {
      //       e.preventDefault()
      //       swal({
      //         title: "Are you sure?",
      //         text: "Once deleted, you will not be able to recover this Todo!",
      //         icon: "warning",
      //         buttons: true,
      //         dangerMode: true,
      //       })
      //       .then((willDelete) => {
      //         if (willDelete) {
      //           swal("Conratulation! Your Todo has been deleted!", {
      //             icon: "success",
      //           });
      //           console.log('remove:', e)
      //           console.log('ajax ke http://localhost:3500/todos/', e.target.name)
      //         } else {
      //           swal("Your imaginary file is safe!");
      //         }
      //       });
      //     })
      //     $(".edit-todo").click((e) => {

      //     })
      //   })
      // });
    </script>
  </body>
</html>